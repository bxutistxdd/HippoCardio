<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Administraci√≥n de Salud</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* ================================================= */
        /* üé® PALETA DE COLORES (VERDE PETR√ìLEO/TEAL) */
        /* ================================================= */
        :root {
            /* Verde Petr√≥leo / Teal para la salud y la estabilidad */
            --color-primary: #00796B; /* Teal Oscuro Est√°ndar */
            --color-primary-dark: #004D40; /* Teal muy oscuro */
            --color-bg-light: #e0f2f1; /* Fondo extra ligero para contraste */
            --color-card-bg: #ffffff;
            --color-text-dark: #263238;
            --color-text-label: #546e7a;
            --color-border: #b2ebf2;
            --color-accent: #ffb300; /* Amarillo para acentuar botones clave (PDF/Logout) */
            --color-error: #f44336;
        }

        /* ================================================= */
        /* üåé ESTILOS GENERALES Y LAYOUT */
        /* ================================================= */
        body { 
            margin: 0; 
            font-family: 'Roboto', 'Segoe UI', sans-serif; 
            background-color: var(--color-bg-light); 
            color: var(--color-text-dark); 
        }
        .container { 
            max-width: 1300px; 
            margin: 0px auto 50px auto; 
            padding: 20px; 
        }

        /* ================================================= */
        /* üîù ENCABEZADO Y CERRAR SESI√ìN */
        /* ================================================= */
        header { 
            background-color: var(--color-primary); 
            color: #FFF; 
            padding: 30px 20px; 
            text-align: center; 
            border-radius: 15px; 
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15); 
            position: relative; 
            margin-bottom: 25px;
        }
        header h2 { 
            margin: 0; 
            font-size: 2.2rem; 
            font-weight: 500;
        }
        .logout-btn { 
            position: absolute; 
            top: 25px; 
            right: 25px; 
            background-color: var(--color-accent); 
            color: var(--color-text-dark); 
            border: none; 
            padding: 10px 20px; 
            border-radius: 8px; 
            font-size: 0.9rem; 
            font-weight: 700; 
            text-decoration: none; 
            cursor: pointer; 
            transition: all 0.3s ease; 
        }
        .logout-btn:hover { 
            background-color: #ffc107; 
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transform: translateY(-1px);
        }

        /* ================================================= */
        /* ‚öôÔ∏è FORMULARIO DE FILTROS (GRID) */
        /* ================================================= */
        form { 
            background-color: var(--color-card-bg); 
            padding: 30px; 
            margin-top: 25px; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 25px; 
        }
        @media (max-width: 1000px) {
            form {
                grid-template-columns: repeat(2, 1fr); 
            }
        }
        @media (max-width: 600px) {
            form {
                grid-template-columns: 1fr; 
            }
        }

        .form-group { display: flex; flex-direction: column; }
        form label { 
            font-weight: 600; 
            color: var(--color-text-label); 
            margin-bottom: 8px; 
            font-size: 0.95rem; 
        }
        
        form input, 
        form select { 
            width: 100%; 
            padding: 12px 15px; 
            border: 1px solid var(--color-border);
            border-radius: 10px; 
            font-size: 1rem; 
            transition: all 0.3s ease;
            box-sizing: border-box; 
            background-color: #fcfcfc;
        }
        form input:focus, 
        form select:focus { 
            outline: none; 
            border-color: var(--color-primary); 
            box-shadow: 0 0 0 3px rgba(0, 121, 107, 0.2); 
            background-color: var(--color-card-bg);
        }
        
        .form-actions { 
            grid-column: 1 / -1; 
            text-align: center; 
            margin-top: 15px; 
        }
        form button { 
            padding: 14px 30px; 
            background-color: var(--color-primary); 
            color: #FFF; 
            border: none; 
            border-radius: 10px; 
            font-size: 1.05rem; 
            font-weight: bold; 
            cursor: pointer; 
            transition: background-color 0.3s ease, transform 0.1s;
        }
        form button:hover { 
            background-color: var(--color-primary-dark);
            transform: translateY(-1px); 
        }

        /* ================================================= */
        /* üìä RESULTADOS Y TARJETAS DE DATOS (NUEVO) */
        /* ================================================= */
        h3 { 
            margin-top: 40px; 
            color: var(--color-primary-dark); 
            font-size: 1.6rem; 
            border-bottom: 2px solid var(--color-border); 
            padding-bottom: 8px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            font-weight: 600;
        }
        h3 i {
            margin-right: 10px;
            color: var(--color-primary);
        }

        .pdf-btn { 
            font-size: 0.9rem; 
            background-color: var(--color-accent); 
            color: var(--color-text-dark); 
            padding: 8px 15px; 
            border-radius: 8px; 
            text-decoration: none;
            font-weight: 700;
            transition: background-color 0.3s ease;
        }
        .pdf-btn:hover { 
            background-color: #ffc107;
        }
        
        ul { list-style: none; padding: 0; margin-top: 15px; }

        /* Estilo de Tarjeta de Resultado */
        ul li { 
            background-color: var(--color-card-bg); 
            padding: 15px 20px; 
            margin-bottom: 12px; 
            border-radius: 10px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); 
            font-size: 0.95rem; 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: space-between; 
            align-items: center; 
            border-left: 6px solid var(--color-primary); /* Barra de color destacada */
            transition: transform 0.2s ease;
        }
        ul li:hover {
            transform: translateY(-2px); 
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
        }

        /* Contenido y Campos de datos dentro de la tarjeta */
        .data-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; 
            flex-grow: 1;
        }

        .data-field {
            font-weight: 500;
            color: var(--color-text-dark);
            display: flex;
            align-items: center;
            font-size: 0.95rem;
        }

        .data-field strong {
            font-weight: 700;
            color: var(--color-primary-dark); 
            margin-left: 5px;
        }

        .data-field i {
            color: var(--color-primary);
            margin-right: 5px;
        }
        
        /* Acciones r√°pidas (Editar/Eliminar) */
        .data-actions {
            margin-left: 20px;
            display: flex;
            gap: 10px;
            /* Asegura que los botones se vean bien en m√≥viles */
            margin-top: 5px; 
        }
        @media (max-width: 768px) {
            .data-actions {
                margin-left: auto; /* Mueve las acciones a la derecha si no hay suficiente espacio */
            }
        }

        .action-btn {
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: background-color 0.2s;
            display: inline-flex;
            align-items: center;
        }

        .edit-btn {
            background-color: #ffe082; 
            color: var(--color-text-dark);
        }
        .edit-btn:hover {
            background-color: #ffc107;
        }

        .delete-btn {
            background-color: #ffcdd2; 
            color: var(--color-error);
        }
        .delete-btn:hover {
            background-color: #ef9a9a;
        }
        .action-btn i {
            margin-right: 5px;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h2>Admin Dashboard</h2>
        <a th:href="@{/}" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Cerrar sesi√≥n</a>
    </header>

    <form method="GET" th:action="@{/admin/dashboard}">
        <div class="form-group">
            <label for="nombre">Nombre:</label>
            <input type="text" name="nombre" id="nombre" th:value="${nombre}" placeholder="Nombre del paciente">
        </div>

        <div class="form-group">
            <label for="edad">Edad:</label>
            <input type="number" name="edad" id="edad" th:value="${edad}" placeholder="Ej: 45">
        </div>

        <div class="form-group">
            <label for="tipo_diabetes">Tipo de Diabetes:</label>
            <select name="tipoDiabetes" id="tipo_diabetes">
                <option value="">Cualquiera</option>
                <option value="Tipo 1" th:selected="${tipoDiabetes == 'Tipo 1'}">Tipo 1</option>
                <option value="Tipo 2" th:selected="${tipoDiabetes == 'Tipo 2'}">Tipo 2</option>
                <option value="Gestacional" th:selected="${tipoDiabetes == 'Gestacional'}">Gestacional</option>
            </select>
        </div>

        <div class="form-group">
            <label for="tipo_ets">Tipo de ETS:</label>
            <select name="tipoEts" id="tipo_ets">
                <option value="">Cualquiera</option>
                <option value="VIH" th:selected="${tipoEts == 'VIH'}">VIH</option>
                <option value="S√≠filis" th:selected="${tipoEts == 'S√≠filis'}">S√≠filis</option>
                <option value="Gonorrea" th:selected="${tipoEts == 'Gonorrea'}">Gonorrea</option>
                <option value="Otro" th:selected="${tipoEts == 'Otro'}">Otro</option>
            </select>
        </div>

        <div class="form-group">
            <label for="presion_arterial">Presi√≥n Arterial:</label>
            <input type="text" name="presionArterial" id="presion_arterial" th:value="${presionArterial}" placeholder="Ej: 130/85">
        </div>

        <div class="form-group">
            <label for="peso">Peso (kg):</label>
            <input type="number" name="peso" id="peso" th:value="${peso}" placeholder="Ej: 80">
        </div>

        <div class="form-group">
            <label for="altura">Altura (m):</label>
            <input type="number" name="altura" id="altura" th:value="${altura}" placeholder="Ej: 1.75">
        </div>

        <div class="form-group">
            <label for="imc">IMC:</label>
            <input type="number" step="0.1" name="imc" id="imc" th:value="${imc}" placeholder="Ej: 25.5">
        </div>

        <div class="form-actions">
            <button type="submit"><i class="fas fa-filter"></i> Aplicar Filtros</button>
        </div>

        <div class="form-actions">
            <button type="button" id="btnEnviarMasivo"><i class="fas fa-filter"></i> Enviar correos masivos</button>
        </div>
    </form>

    <h3><i class="fas fa-candy-cane"></i> Formularios de Diabetes: 
        <a th:href="@{/admin/pdf/diabetes}" target="_blank" class="pdf-btn"><i class="fas fa-file-pdf"></i> PDF REPORTE GENERAL</a>
    </h3>
    <ul>
        <li th:each="formulario : ${diabetesList}">
            <div class="data-content">
                <div class="data-field">
                    <i class="fas fa-user-tag"></i> Paciente: 
                    <strong><span th:text="${formulario.nombre}"></span></strong>
                </div>
                <div class="data-field">
                    <i class="fas fa-birthday-cake"></i> Edad: 
                    <strong><span th:text="${formulario.edad}"></span></strong>
                </div>
                <div class="data-field">
                    <i class="fas fa-syringe"></i> Tipo: 
                    <strong><span th:text="${formulario.tipoDiabetes}"></span></strong>
                </div>
            </div>
            <div class="data-actions">
                <a th:href="@{/admin/editar/diabetes/{id}(id=${formulario.id})}" class="action-btn edit-btn">
                    <i class="fas fa-edit"></i>
                </a>
                <a th:href="@{/admin/eliminar/diabetes/{id}(id=${formulario.id})}" class="action-btn delete-btn">
                    <i class="fas fa-trash-alt"></i>
                </a>
            </div>
        </li>
    </ul>

    <h3><i class="fas fa-venus-mars"></i> Formularios de ETS: 
        <!-- <a th:href="@{/admin/pdf/ets}" target="_blank" class="pdf-btn"><i class="fas fa-file-pdf"></i> PDF</a> -->
    </h3>
    <ul>
        <li th:each="formulario : ${etsList}">
            <div class="data-content">
                <div class="data-field">
                    <i class="fas fa-user-tag"></i> Paciente: 
                    <strong><span th:text="${formulario.nombre}"></span></strong>
                </div>
                <div class="data-field">
                    <i class="fas fa-microscope"></i> Tipo: 
                    <strong><span th:text="${formulario.tipoEts}"></span></strong>
                </div>
            </div>
            <div class="data-actions">
                <a th:href="@{/admin/editar/ets/{id}(id=${formulario.id})}" class="action-btn edit-btn">
                    <i class="fas fa-edit"></i>
                </a>
                <a th:href="@{/admin/eliminar/ets/{id}(id=${formulario.id})}" class="action-btn delete-btn">
                    <i class="fas fa-trash-alt"></i>
                </a>
            </div>
        </li>
    </ul>

    <h3><i class="fas fa-heartbeat"></i> Formularios de Hipertensi√≥n: 
        <!-- <a th:href="@{/admin/pdf/hipertension}" target="_blank" class="pdf-btn"><i class="fas fa-file-pdf"></i> PDF</a> -->
    </h3>
    <ul>
        <li th:each="formulario : ${hipertensionList}">
            <div class="data-content">
                <div class="data-field">
                    <i class="fas fa-user-tag"></i> Paciente: 
                    <strong><span th:text="${formulario.nombre}"></span></strong>
                </div>
                <div class="data-field">
                    <i class="fas fa-stethoscope"></i> P. Arterial: 
                    <strong><span th:text="${formulario.presionArterial}"></span></strong>
                </div>
                <div class="data-field">
                    <i class="fas fa-weight"></i> Peso: 
                    <strong><span th:text="${formulario.peso}"></span> kg</strong>
                </div>
                <div class="data-field">
                    <i class="fas fa-ruler-vertical"></i> Altura: 
                    <strong><span th:text="${formulario.altura}"></span> m</strong>
                </div>
            </div>
            <div class="data-actions">
                <a th:href="@{/admin/editar/hipertension/{id}(id=${formulario.id})}" class="action-btn edit-btn">
                    <i class="fas fa-edit"></i>
                </a>
                <a th:href="@{/admin/eliminar/hipertension/{id}(id=${formulario.id})}" class="action-btn delete-btn">
                    <i class="fas fa-trash-alt"></i>
                </a>
            </div>
        </li>
    </ul>

    <h3><i class="fas fa-weight-scale"></i> Formularios de Obesidad: 
        <!-- <a th:href="@{/admin/pdf/obesidad}" target="_blank" class="pdf-btn"><i class="fas fa-file-pdf"></i> PDF</a> -->
    </h3>
    <ul>
        <li th:each="formulario : ${obesidadList}">
            <div class="data-content">
                <div class="data-field">
                    <i class="fas fa-user-tag"></i> Paciente: 
                    <strong><span th:text="${formulario.nombre}"></span></strong>
                </div>
                <div class="data-field">
                    <i class="fas fa-ruler-combined"></i> IMC: 
                    <strong><span th:text="${formulario.imc}"></span></strong>
                </div>
            </div>
            <div class="data-actions">
                <a th:href="@{/admin/editar/obesidad/{id}(id=${formulario.id})}" class="action-btn edit-btn">
                    <i class="fas fa-edit"></i>
                </a>
                <a th:href="@{/admin/eliminar/obesidad/{id}(id=${formulario.id})}" class="action-btn delete-btn">
                    <i class="fas fa-trash-alt"></i>
                </a>
            </div>
        </li>
    </ul>
</div>

<script>
document.getElementById("btnEnviarMasivo").addEventListener("click", async () => {
    try {
        // 1Ô∏è‚É£ Obtener correos de la base de datos
        const response = await fetch("/email/usuarios/emails");
        const destinatarios = await response.json();
        console.log("Destinatarios obtenidos:", destinatarios);

        // 2Ô∏è‚É£ Preparar payload
        const payload = {
            destinatarios: destinatarios,
            asunto: "HIPPOCARDIO - Recuerda ingresar a HippoCardio para seguir de cerca tu salud",
            mensaje: "Hola, Recuerda cumplir tus objetivos con HippoCardio. Cada d√≠a que registras tus avances es un paso m√°s hacia una vida m√°s sana y equilibrada.Ingresa a la app y revisa tu progreso, mant√©n el control de tu presi√≥n arterial, ritmo card√≠aco y h√°bitos diarios. ¬°Tu salud merece tu atenci√≥n constante! El equipo de HippoCardio."
        };

        // 3Ô∏è‚É£ Enviar correos masivos
        const sendResponse = await fetch("/email/masivo", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const result = await sendResponse.text();
        alert(result);

    } catch (error) {
        alert("Error al enviar correos: " + error);
    }
});
</script>

</body>
</html>